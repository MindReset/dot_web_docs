---
title: MSA-2025-09-002
description: における NoSQL インジェクション
---

**公開日**: 2025 年 9 月 29 日  
**最終更新**: 2025 年 9 月 29 日  
**深刻度**: クリティカル  
**ステータス**: 進行中（暫定的な緩和策を適用、恒久対策を迅速化）  
**CVSS 3.1 スコア**: 9.1 (AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

---

## 概要

2025-09-29T04:23:00Z、/api/device/template エンドポイントに NoSQL インジェクションの脆弱性があるとのセキュリティ報告を受領しました。本エンドポイントは本来、サーバーサイドのレンダリング機能セットを提供する目的でしたが、クライアントから渡された MongoDB の集約パイプライン構造をそのまま受け取り実行していたため、攻撃者が細工したリクエストにより、機密データの読み取り、データの書き込み・改ざん、DoS の誘発などを実行できる高リスクが生じていました。

私たちは直ちに暫定的な緩和策を有効化し、恒久的な修正プロセスを開始しました。現時点では、広範な悪用の証拠は確認されていません。

## 影響範囲

| 項目                   | 詳細                                                                                     |
| :--------------------- | :--------------------------------------------------------------------------------------- |
| 影響を受ける製品       | Dot サーバーサイド API                                                                   |
| 影響を受けるバージョン | /api/device/template の現行本番バージョン                                                |
| 修正バージョン         | 後日告知（恒久修正のリリース後に更新）                                                   |
| 影響コンポーネント     | /api/device/template（MongoDB 集約パイプラインの実行）                                   |
| 攻撃ベクトル           | ネットワーク                                                                             |
| 必要な権限             | 低（有効なユーザートークンがある場合は影響増大。弱い検証の一部シナリオでは濫用の可能性） |

## 技術的説明

-           原因：エンドポイントが集約のオペレーターと構造をクライアントにより直接制御可能とし、サーバーでそのまま実行していたため、NoSQL インジェクションの攻撃面が生じました。
-           再現要点：$unionWith などの高リスクなステージを含む集約を構成することで、他のコレクションのデータへ越権アクセスが可能になります。
-           リスク：機密性 (C) 高、完全性 (I) 高、可用性 (A) 高。

## 対応

リスクを迅速に低減し注入の攻撃面を完全に除去するため、以下の二段階で進めます（暫定措置と恒久対策）:

-           即時措置（進行中）:
    -   /api/device/template における高リスクオペレーターを一時的に無効化または段階的に制限し、厳格なフィールドのホワイトリストおよびレート制限を適用。$unionWith/$lookup/$out/$merge などの疑わしいステージを遮断します。
    -   リクエストの監査とアラートを強化し、不審なアクセス元や頻度を特定します。
-           恒久対策（できるだけ早期に完了・リリース）:
    -   サーバーサイドのパラメータ化とクエリビルダーを導入し、制御された集約ステージのみをサーバーで構築。クライアントによるオペレーターや自由形式の構造の持ち込みを禁止します。
    -   返却データを最小化（フィールドレベルの射影・マスキング）し、ユーザーおよびリソース境界に基づくきめ細かな認可検証を強制します。
    -   過去の同種エンドポイントを包括的に監査し、同様のリスクを排除します。

## 影響評価

-           悪用の証拠なし：ログに異常な大量アクセスやデータ持ち出しは確認されていません。

## ユーザー向けアクション

-           現時点でユーザー側の対応は不要です。サーバー側での遮断・制限策を有効化しており、恒久対策を速やかに完了します。
-           異常なレスポンスや不審な挙動を確認した場合は、公式チャネルへ速やかにご連絡ください。

## 謝辞

本件を責任ある開示でご報告いただき、修正検証にもご協力いただいた [Mason](https://mas0n.org) 様に深く感謝いたします。

---

**免責事項**：本アドバイザリは、現時点で入手可能な情報に基づき作成されています。関連する脅威インテリジェンスを継続的に監視し、重要な更新がある場合は速やかに改訂します。  
**文書番号**：MSA-2025-09-002
**分類レベル**：公開  
**発行機関**：MindReset セキュリティチーム
