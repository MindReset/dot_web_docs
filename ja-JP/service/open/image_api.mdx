---
title: 画像内容を制御
---

import Link from 'fumadocs-core/link';
import { Tab, Tabs } from 'fumadocs-ui/components/tabs';
import { ApiPlayground } from 'src/shadcn/components/api-playground';
import { TypeTable } from 'src/shadcn/components/type-table';

<Callout type="warning" title="API 移行のお知らせ">
	旧エンドポイント `https://dot.mindreset.tech/api/open/image` は近日中に廃止予定です。
	移行負担を軽減するため、旧エンドポイントへのリクエストは新しい API へ自動転送されますが、
	この互換動作は将来的に廃止される可能性があります。

    できるだけ早く以下の対応を行うことを強く推奨します：
    - リクエスト URL を新しいエンドポイントへ更新：`/api/authV2/open/device/:deviceId/image`
    - 本ドキュメントのリクエスト構造に従ってパラメータを送信（例：`refreshNow` / `image` / `link` / `border` / `ditherType` / `ditherKernel`）
    - 旧版のレスポンス内容やエラーコードに依存している場合は、新版 API のレスポンスに合わせて調整

</Callout>

## クイックガイド

### 必要条件

1. Dot. アプリで<Link href="/docs/service/studio/api/get_api">API キーを取得して保存</Link>していること
2. 自分のデバイスが少なくとも 1 台あり、<Link href="/docs/service/studio/api/get_device_id">デバイスのシリアル番号</Link>を取得していること
3. デバイスが電源に接続されていること
4. デバイスがネットワークに接続されていること
5. デバイスに「画像 API」コンテンツが追加されていること

<Callout
	type="info"
	title="APIのリクエスト制限は1秒あたり10回です。APIを使うとデバイスの動作と応答をより柔軟に制御できます。"
/>

<Callout
	type="info"
	title="ドキュメント中の「{{変数}}」は置換が必要なプレースホルダーです。実際の値に置き換え、「{{}}」は削除してください。"
/>

### リクエスト例

<ApiPlayground
	baseUrl="https://dot.mindreset.tech"
	endpoint="/api/authV2/open/device/:deviceId/image"
	method="POST"
	pathParams={{
		deviceId: {
			type: 'string',
			required: true,
			name: 'デバイスシリアル番号',
		},
	}}
	bodyParams={{
		refreshNow: {
			type: 'boolean',
			name: '内容を即時表示するか',
			default: true,
		},
		image: {
			type: 'textarea',
			required: true,
			name: 'base64 エンコードした PNG 画像データ',
		},
		link: {
			type: 'string',
			name: 'タッチ操作時の遷移リンク',
		},
		border: {
			type: 'select',
			name: '画面枠の色',
			default: 0,
			options: [
				{ value: 0, label: '白' },
				{ value: 1, label: '黒' },
			],
		},
		ditherType: {
			type: 'select',
			name: 'ディザ種別',
			default: 'DIFFUSION',
			options: [
				{ value: 'DIFFUSION', label: '誤差拡散' },
				{ value: 'ORDERED', label: '順序ディザ' },
				{ value: 'NONE', label: 'なし' },
			],
		},
		ditherKernel: {
			type: 'select',
			name: 'ディザアルゴリズム',
			default: 'FLOYD_STEINBERG',
			options: [
				{ value: 'THRESHOLD' },
				{ value: 'ATKINSON' },
				{ value: 'BURKES' },
				{ value: 'FLOYD_STEINBERG' },
				{ value: 'SIERRA2' },
				{ value: 'STUCKI' },
				{ value: 'JARVIS_JUDICE_NINKE' },
				{ value: 'DIFFUSION_ROW' },
				{ value: 'DIFFUSION_COLUMN' },
				{ value: 'DIFFUSION_2D' },
			],
		},
	}}
	auth={true}
	defaultOpen={false}
/>

### レスポンス例

```json
{
	"code": 200,
	"message": "デバイスの画像 API コンテンツを切り替えました",
	"result": {
		"message": "デバイス ABCD1234ABCD の画像 API コンテンツを切り替えました"
	}
}
```

## 参考ユースケース

1. シンプル画像（即時表示しない）

<CustomCloudImage osSrc="dot/docs/陰影_1754129505817.png" alt="実際の効果" />

<Tabs items={['cURL']}>
  <Tab value="cURL">
    ```bash
    curl -X POST \
		  https://dot.mindreset.tech/api/authV2/open/device/{{deviceId}}/image \
      -H 'Authorization: Bearer dot_app_UlSpzXNEXhYZIAFakHLCkMVVBLbsBIWxaRMVaJZGUOYKhDoDRZwLLvLujAIwQxbY' \
      -H 'Content-Type: application/json' \
      -d '{
        "refreshNow": false,
        "image": "{{base64 エンコードした PNG 画像データ}}",
        "link": "https://dot.mindreset.tech",
        "border": 0
      }'
    ```
  </Tab>
</Tabs>

2. 複雑な画像

<CustomCloudImage osSrc="dot/docs/陰影4_1754130316522.png" alt="実際の効果" />

<Tabs items={['cURL']}>
  <Tab value="cURL">
    ```bash
    curl -X POST \
		  https://dot.mindreset.tech/api/authV2/open/device/{{deviceId}}/image \
      -H 'Authorization: Bearer dot_app_UlSpzXNEXhYZIAFakHLCkMVVBLbsBIWxaRMVaJZGUOYKhDoDRZwLLvLujAIwQxbY' \
      -H 'Content-Type: application/json' \
      -d '{
        "image": "{{base64 エンコードした PNG 画像データ}}",
        "link": "https://dot.mindreset.tech",
        "border": 1
      }'
    ```
  </Tab>
</Tabs>

3. テキスト画像

Figma、Sketch、Adobe Photoshop などでテキストを PNG に変換し、さらに base64 に変換して送信します。

<CustomCloudImage osSrc="dot/docs/陰影3_1754130631116.png" alt="実際の効果" />

<Tabs items={['cURL']}>
  <Tab value="cURL">
    ```bash
    curl -X POST \
		  https://dot.mindreset.tech/api/authV2/open/device/{{deviceId}}/image \
      -H 'Authorization: Bearer dot_app_UlSpzXNEXhYZIAFakHLCkMVVBLbsBIWxaRMVaJZGUOYKhDoDRZwLLvLujAIwQxbY' \
      -H 'Content-Type: application/json' \
      -d '{
        "image": "{{base64 エンコードした PNG 画像データ}}",
        "link": "https://dot.mindreset.tech",
        "border": 0,
        "ditherType": "NONE"
      }'
    ```
  </Tab>
</Tabs>

## 画像ディザリング

画像ディザリングは、特定のアルゴリズムで視覚ノイズを低減し、見た目を滑らかにする処理です。Floyd-Steinberg、Atkinson、Sierra などが代表例です。電子ペーパーでは階調の遷移が自然になり、白黒表示の質が向上します。

画像 API では、**`ditherType`を指定しない場合**、誤差拡散ディザの Floyd-Steinberg をデフォルトで使用します。パラメータで無効化や種類・アルゴリズムの変更が可能です。

### ディザリングを有効化

#### 誤差拡散ディザ（デフォルト）

誤差拡散ディザは、各ピクセルの誤差を周囲のピクセルに分配することで視覚ノイズを低減し、見た目を滑らかにする処理です。このアルゴリズムは画像中のコントラストの高い領域を効果的に処理し、階調間の遷移をより自然にします。通常、点的分布が自然で、明らかな規則的なグリッドパターンがなく、詳細な表現が豊かで、階調の遷移が滑らかな効果を示します。

<CustomCloudImage osSrc="dot/docs/陰影-1_1755604439407.png" alt="実際の効果" />

<Tabs items={['cURL']}>
  <Tab value="cURL">
    ```bash
    curl -X POST \
		  https://dot.mindreset.tech/api/authV2/open/device/{{deviceId}}/image \
      -H 'Authorization: Bearer dot_app_UlSpzXNEXhYZIAFakHLCkMVVBLbsBIWxaRMVaJZGUOYKhDoDRZwLLvLujAIwQxbY' \
      -H 'Content-Type: application/json' \
      -d '{
        "image": "{{base64 エンコードした PNG 画像データ}}",
        "link": "https://dot.mindreset.tech",
        "border": 0,
        "ditherType": "DIFFUSION"
      }'
    ```
  </Tab>
</Tabs>

##### 誤差拡散アルゴリズムの種類

異なる誤差拡散アルゴリズムは異なる視覚効果を生み出します。以下は現在サポートされているアルゴリズムです。パラメータを渡す際は `"ditherKernel": "{{ディザアルゴリズム}}"` で渡します。

<div className="flex flex-col md:flex-row gap-4">

<CustomCloudImage
	osSrc="dot/docs/layer_1755606583517.png"
	alt="FLOYD_STEINBERG"
	caption="FLOYD_STEINBERG"
/>

<CustomCloudImage osSrc="dot/docs/layer-1_1755606614917.png" alt="ATKINSON" caption="ATKINSON" />
<CustomCloudImage osSrc="dot/docs/layer-2_1755606637222.png" alt="BURKES" caption="BURKES" />

</div>

<div className="flex flex-col md:flex-row gap-4">

<CustomCloudImage osSrc="dot/docs/layer-3_1755606653679.png" alt="SIERRA2" caption="SIERRA2" />

<CustomCloudImage osSrc="dot/docs/layer-4_1755606678514.png" alt="STUCKI" caption="STUCKI" />
<CustomCloudImage
	osSrc="dot/docs/layer-5_1755606710423.png"
	alt="JARVIS_JUDICE_NINKE"
	caption="JARVIS_JUDICE_NINKE"
/>

</div>

<div className="flex flex-col md:flex-row gap-4">

<CustomCloudImage
	osSrc="dot/docs/layer-6_1755606726561.png"
	alt="DIFFUSION_ROW"
	caption="DIFFUSION_ROW"
/>

<CustomCloudImage
	osSrc="dot/docs/layer-7_1755606742614.png"
	alt="DIFFUSION_COLUMN"
	caption="DIFFUSION_COLUMN"
/>
<CustomCloudImage
	osSrc="dot/docs/layer-8_1755606760506.png"
	alt="DIFFUSION_2D"
	caption="DIFFUSION_2D"
/>

</div>

#### 有序ディザ（Ordered）

有序ディザは、規則的なディザ行列を画像ピクセルに適用することで階調やカラーの近似を実現するアルゴリズムです。誤差拡散ディザとは異なり、有序ディザはピクセル誤差に基づいて周囲ピクセルの値を動的に調整するのではなく、あらかじめ定義された固定のディザ行列を画像全体に周期的に重ね合わせます。この方法は大面積のカラーブロックやバンディング現象を効果的に軽減し、視覚的により均一な点阵分布を実現します。ディザ行列の周期性により、有序ディザが生成する画像は通常、一定の規則性とグリッド感を伴います。

<CustomCloudImage osSrc="dot/docs/陰影-2_1755604633182.png" alt="実際の効果" />

<Tabs items={['cURL']}>
  <Tab value="cURL">
    ```bash
    curl -X POST \
		  https://dot.mindreset.tech/api/authV2/open/device/{{deviceId}}/image \
      -H 'Authorization: Bearer dot_app_UlSpzXNEXhYZIAFakHLCkMVVBLbsBIWxaRMVaJZGUOYKhDoDRZwLLvLujAIwQxbY' \
      -H 'Content-Type: application/json' \
      -d '{
        "image": "{{base64 エンコードした PNG 画像データ}}",
        "link": "https://dot.mindreset.tech",
        "border": 0,
        "ditherType": "ORDERED"
      }'
    ```
  </Tab>
</Tabs>

### ディザリングを無効化

テキスト中心の画像では、ディザリングを無効にするとエッジがシャープになり可読性が向上します。画像 API をテキスト画像として使用する場合は、ディザリングを無効にすることでよりシャープな文字効果が得られます。

<CustomCloudImage osSrc="dot/docs/陰影_1755604287570.png" alt="実際の効果" />

<Tabs items={['cURL']}>
  <Tab value="cURL">
    ```bash
    curl -X POST \
		  https://dot.mindreset.tech/api/authV2/open/device/{{deviceId}}/image \
      -H 'Authorization: Bearer dot_app_UlSpzXNEXhYZIAFakHLCkMVVBLbsBIWxaRMVaJZGUOYKhDoDRZwLLvLujAIwQxbY' \
      -H 'Content-Type: application/json' \
      -d '{
        "image": "{{base64 エンコードした PNG 画像データ}}",
        "link": "https://dot.mindreset.tech",
        "border": 0,
        "ditherType": "NONE"
      }'
    ```
  </Tab>
</Tabs>

## トラブルシューティング

### リクエストパス

`/api/authV2/open/device/:deviceId/image`

### メソッド

`POST`

### リクエスト構造

<TypeTable
	type={{
		refreshNow: {
			description: 'コンテンツを即時に表示するかどうか（表示タイミング制御）',
			type: 'bool',
			default: 'true',
		},
		image: {
			description: 'base64 エンコードの PNG 画像データ（296px×152px）（表示する画像）',
			type: 'string',
			required: true,
		},
		link: {
			description: 'http/https またはスキーム URL（タッチ操作の遷移先）',
			type: 'string',
		},
		border: {
			description: '0は白枠、1は黒枠（画面の枠色）',
			type: 'number',
			default: '0',
		},
		ditherType: {
			description: 'ディザ種別（DIFFUSION、ORDERED、NONE）（画像ディザ効果）',
			type: 'string',
			default: 'DIFFUSION',
		},
		ditherKernel: {
			description:
				'ディザアルゴリズム（THRESHOLD、ATKINSON、BURKES、FLOYD_STEINBERG、SIERRA2、STUCKI、JARVIS_JUDICE_NINKE、DIFFUSION_ROW、DIFFUSION_COLUMN、DIFFUSION_2D）（ディザのアルゴリズム）',
			type: 'string',
			default: 'FLOYD_STEINBERG',
		},
	}}
/>

### レスポンス構造

<TypeTable
	type={{
		code: {
			description: 'ステータスコード',
			type: 'number',
			required: true,
		},
		message: {
			description: '応答メッセージ',
			type: 'string',
			required: true,
		},
	}}
/>

### レスポンスコード

| code  | 意味             | 説明                                                                                                               |
| :---- | :--------------- | :----------------------------------------------------------------------------------------------------------------- |
| `200` | 成功             | デバイスの画像 API コンテンツを切り替え／データ更新（ただし表示は切り替わっていない）                              |
| `400` | パラメータ不正   | デバイス ID の欠如または形式不正／無効な画像形式／border は 0 または 1／無効なディザ種別／無効なディザアルゴリズム |
| `403` | 権限不足         | 当該デバイスを操作する権限がありません                                                                             |
| `404` | 未検出           | デバイスが存在しない・未登録／画像 API コンテンツ未追加                                                            |
| `500` | デバイス応答失敗 | 画像 API コンテンツの切替に失敗                                                                                    |
