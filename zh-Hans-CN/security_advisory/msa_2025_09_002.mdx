---
title: MSA-2025-09-002
description: 存在 NoSQL 注入
---

**发布日期**: 2025 年 9 月 29 日  
**最后更新**: 2025 年 9 月 29 日  
**严重等级**: Critical  
**状态**: 进行中（已采取临时缓解）  
**CVSS 3.1 评分**: 9.1 (AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

---

## 概述

我们在 2025-09-29T06:23:00Z 收到关于 /api/device/template 接口存在 NoSQL 注入漏洞的安全报告。该接口原用于获取服务端渲染能力集合，但由于直接接受并执行由客户端传入的 MongoDB 聚合管道（aggregation）结构，导致攻击者可通过构造恶意请求实现包括但不限于读取数据库敏感数据、写入/篡改数据以及触发 DOS 的高危风险。

我们已立即启用临时缓解措施，并启动根本性修复流程。目前未发现大规模恶意利用的证据。

## 影响范围

| 项目           | 详情                                                         |
| -------------- | ------------------------------------------------------------ |
| **受影响产品** | Dot 服务端 API                                               |
| **受影响版本** | /api/device/template 现网版本                                |
| **修复版本**   | 将另行公告（根本修复上线后更新）                             |
| **受影响组件** | /api/device/template（MongoDB 聚合管道执行）                 |
| **攻击向量**   | 网络（Network）                                              |
| **所需权限**   | 低（持有用户令牌时影响更大；部分场景下可能在弱校验下被滥用） |

## 技术描述

-   问题成因：接口允许客户端直接控制聚合管道的 operators 与 structure，并在服务端原样执行，形成 NoSQL 注入面。
-   复现要点：通过构造包含 $unionWith 等高风险阶段的 aggregation 可越权访问其他集合数据。
-   风险：机密性（C）高危、完整性（I）高危、可用性（A）高危。

## 修复措施

为快速降低风险并彻底根除注入面，我们分两阶段推进（处置与修复计划）：

-   立即措施（进行中）：

    -   临时关闭或灰度限制 /api/device/template 高风险操作符，启用严格字段白名单与速率限制，拦截可疑聚合阶段（如 $unionWith/$lookup/$out/$merge 等）。
    -   增加请求审计与告警，定位可疑访问来源与频次。

-   根本修复（将尽快完成并上线）：
    -   引入服务端参数化与查询构建器，统一在服务端拼接受控的聚合阶段，禁止客户端传入 operators 或自由结构。
    -   最小化返回数据（字段级筛选与脱敏），并按用户与资源的授权边界做精细化授权校验。
    -   对历史同类接口做全面审计，消除同类风险。

## 影响评估

-   未发现恶意利用证据：日志未见异常批量访问与数据导出

## 用户行动建议

-   暂无用户侧操作必要。我们已在服务端启用拦截与限制策略，并将尽快完成根本修复。
-   若您发现异常返回或可疑行为，请通过官方渠道及时反馈。

## 致谢

我们衷心感谢 [Mason](https://mas0n.org) 通过负责任的安全披露方式报告此问题，并在修复过程中提供了宝贵的验证协助。这种合作精神有助于保护所有用户的数据安全。

---

**免责声明**: 本公告基于当前可获得的信息编制。我们将持续监控相关威胁情报，如有重大更新将及时修订本公告。  
**文档编号**: MSA-2025-09-002  
**分类等级**: 公开  
**发布机构**: MindReset 安全团队
